//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
// IndieZen Game Engine Framework
//
// Copyright (C) 2001 - 2007 Tony Richards
// Copyright (C)        2009 Brian Roberts
//
//  This software is provided 'as-is', without any express or implied
//  warranty.  In no event will the authors be held liable for any damages
//  arising from the use of this software.
//
//  Permission is granted to anyone to use this software for any purpose,
//  including commercial applications, and to alter it and redistribute it
//  freely, subject to the following restrictions:
//
//  1. The origin of this software must not be misrepresented; you must not
//     claim that you wrote the original software. If you use this software
//     in a product, an acknowledgment in the product documentation would be
//     appreciated but is not required.
//  2. Altered source versions must be plainly marked as such, and must not be
//     misrepresented as being the original software.
//  3. This notice may not be removed or altered from any source distribution.
//
//  Tony Richards trichards@indiezen.com
//  Walt Collins (Arcanor) - wcollins@indiezen.com
//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
#include "PhysicsMaterial.hpp"
#include "PhysicsActor.hpp"
#include "PhysicsZone.hpp"

#include <vector>

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
namespace Zen {
namespace ZBullet {
//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
PhysicsMaterial::PhysicsMaterial(wpPhysicsZone_type _zone, bool _default)
:   m_pZone(_zone)
{
    m_pNewtonZone = dynamic_cast<PhysicsZone*>(m_pZone.get())->getZonePtr();
    m_defaultGroupID = 0;

    if (_default)
    {
        m_id = m_defaultGroupID;
    }
    else
    {
        m_id = m_pZone->getAllMaterials().size();
    }

    setCollidable(true);
    setAdvancedCollisionPrediction(false);
    setRestitution(0.25f);
    m_staticFriction = 1.0f;
    setDynamicFriction(0.7f);
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
PhysicsMaterial::~PhysicsMaterial()
{
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
int 
PhysicsMaterial::getMaterialID()
{
    return m_id;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
int 
PhysicsMaterial::getDefaultMaterialID()
{
    return m_defaultGroupID;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
Math::Real 
PhysicsMaterial::getDynamicFriction()
{
    return m_dynamicFriction;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
Math::Real 
PhysicsMaterial::getStaticFriction()
{
    return m_staticFriction;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
Math::Real 
PhysicsMaterial::getRestitution()
{
    return m_restitution;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
bool 
PhysicsMaterial::getAdvancedCollisionPrediction()
{
    return m_bAdvancedCollisionPrediction;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
bool 
PhysicsMaterial::getCollidable()
{
    return m_bCollidable;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setDynamicFriction(Math::Real _dynamicFriction)
{
    // Newton friction coefficients are normally between 0 and 1
    m_dynamicFriction = _dynamicFriction;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setMatMatrixDynamicFriction(pPhysicsMaterial_type _material, Math::Real _dynamicFriction)
{
//todo: for breaking the laws of physics and setting a specific dynamic friction vs a given material
//(done more often than you'd think in practice)
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setStaticFriction(Math::Real _staticFriction)
{
    // Newton friction coefficients are normally between 0 and 1
    m_staticFriction = _staticFriction;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setMatMatrixStaticFriction(pPhysicsMaterial_type _material, Math::Real _staticFriction)
{
//todo: for breaking the laws of physics and setting a specific static friction vs a given material
//(done more often than you'd think in practice)
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setRestitution(Math::Real _restitution)
{
    m_restitution = _restitution;
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setMatMatrixRestitution(pPhysicsMaterial_type _material, Math::Real _restitution)
{
//todo: for breaking the laws of physics and setting a specific restitution vs a given material
//(done more often than you'd think in practice)
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setAdvancedCollisionPrediction(bool _mode)
{
    m_bAdvancedCollisionPrediction = _mode;
//todo: implement ccd (continuous collision detection)
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setCollidable(bool _collide)
{
    m_bCollidable = _collide;
//todo: handle via collisiongroups
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void
PhysicsMaterial::setMatMatrixCollidable(pPhysicsMaterial_type _material, bool _collide)
{
//todo: handle via collisiongroups
}

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
void 
PhysicsMaterial::setIgnoreCollision(pPhysicsMaterial_type _material)
{
//todo: handle via collisiongroups
}

//Research Note: See CustomMaterialCombinerCallback in Bullet/Demos/ConcaveDemo/ConcavePhysicsDemo.cpp for an example implementation.
//We'll likely want to end up putting a global material callback funciton later similar to the newton callbacks in method, if not useage

//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
}   // namespace ZBullet
}   // namespace Zen
//-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
